<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self';">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Dashboard</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <main>
    <h1 id="welcome">Welcome!</h1>
    <div id="user-info">
      <p><strong>Name:</strong> <span id="name">Loading...</span></p>
      <p><strong>Email:</strong> <span id="email">Loading...</span></p>
    </div>

    <div id="profile-placeholder">
      <h3>Profile Update (Coming Soon)</h3>
      <!-- Will be implemented in Part B -->
    </div>

    <button id="logoutBtn">Logout</button>
  </main>

  <script>
    async function fetchUser() {
      try {
        const res = await fetch('/profile/me', {
          credentials: 'include',
        });
        if (!res.ok) throw new Error('Auth error');

        const data = await res.json();
        document.getElementById('welcome').textContent = `Welcome, ${escapeHtml(data.name)}!`;
        document.getElementById('name').textContent = escapeHtml(data.name);
        document.getElementById('email').textContent = escapeHtml(data.email);
      } catch (err) {
        console.error('Error fetching user:', err);
        window.location.href = '/login.html';
      }
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, function (m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
        }[m];
      });
    }

    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await fetch('/auth/logout', {
        method: 'POST',
        credentials: 'include'
      });
      window.location.href = '/login.html';
    });

    fetchUser();
  </script>
</body>
</html>
